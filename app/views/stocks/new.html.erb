<div class="page">
  <div class="page-header">
    <div>
      <h1 class="page-title">在庫登録</h1>
      <p class="page-subtitle">購入した食材を登録します</p>
    </div>
  </div>

  <div class="stock-form-card">
    <%= form_with model: @stock,
          url: stocks_path,
          method: :post,
          data: { turbo: false } do |f| %>

      <!-- 購入日：左寄せ＆横幅小さく -->
      <div class="mb-3">
        <%= f.label :purchased_on, "購入日", class: "form-label fw-bold" %>
        <%= f.date_field :purchased_on,
              class: "form-control stock-date-input",
              value: (@stock.purchased_on || Date.current) %>
      </div>

      <!-- 登録方法 -->
      <div class="mb-3">
        <div class="form-label fw-bold mb-2">登録方法</div>

        <div class="d-flex flex-wrap gap-3">
          <div class="form-check m-0">
            <%= f.radio_button :mode, "master",
                  checked: (@stock.mode != "custom"),
                  class: "form-check-input",
                  id: "mode_master" %>
            <%= f.label :mode_master, "野菜マスターから選択",
                  class: "form-check-label",
                  for: "mode_master" %>
          </div>

          <div class="form-check m-0">
            <%= f.radio_button :mode, "custom",
                  checked: (@stock.mode == "custom"),
                  class: "form-check-input",
                  id: "mode_custom" %>
            <%= f.label :mode_custom, "自由入力",
                  class: "form-check-label",
                  for: "mode_custom" %>
          </div>
        </div>
      </div>

      <!-- 野菜選択（master） -->
      <div class="mb-3" id="master_fields">
        <%= f.label :vegetable_id, "野菜を選択", class: "form-label fw-bold" %>
        <%= f.collection_select :vegetable_id, @vegetables, :id, :name,
              { include_blank: "選択してください" },
              class: "form-select" %>
        <div class="form-text">よく買う野菜はここから選ぶと楽です</div>
      </div>

      <!-- 自由入力（custom） -->
      <div class="mb-3 d-none" id="custom_fields">
        <%= f.label :custom_name, "食材名（自由入力）", class: "form-label fw-bold" %>
        <%= f.text_field :custom_name,
              class: "form-control",
              placeholder: "例：しめじ、豆腐、牛乳 など" %>
        <div class="form-text">マスターに無い食材はこちら</div>
      </div>

      <!-- ボタン：戻る（左）/ 登録（右）どちらも小さく -->
      <div class="d-flex align-items-center mt-4">
        <%= link_to "戻る", stocks_path, class: "btn btn-outline-secondary btn-sm" %>
        <%= f.submit "登録する", class: "btn btn-primary btn-sm ms-auto" %>
      </div>
    <% end %>
  </div>
</div>